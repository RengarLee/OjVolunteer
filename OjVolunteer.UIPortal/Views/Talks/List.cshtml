@model OjVolunteer.UIPortal.Models.TalkViewModel

@{
    Layout = null;
}


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的心得</title>

    <meta name="viewport" content="width=device-width,initial-scale=1">

    <link href="~/Content/oj/css/bootstrap.css" rel="stylesheet" />
    <link href="~/Content/oj/css/iconfont.css" rel="stylesheet" />
    <link href="~/Content/layui/css/layui.css" rel="stylesheet" />
    <link href="~/Content/oj/css/main.css" rel="stylesheet" />


    <script src="~/Content/oj/js/jquery-1.12.4.js"></script>
    <script src="~/Content/oj/js/bootstrap.min.js"></script>
    <script src="~/Content/oj/js/amazeui.min.js"></script>
    <script src="~/Content/oj/js/main.js"></script>
    <script src="~/Scripts/datapattern.js"></script>
    <script type="text/javascript">

        $(function () {
            GetActivityData(1, 5);
        });

        //加载心得数据
        function GetActivityData(pageIndex, pageSize) {
            $.post("/Talks/GetListData", { pageIndex: pageIndex, pageSize: pageSize }, function (data) {
                if (data["msg"] == "success") {
                    pageIndex = pageIndex + 1;
                    var buffer = "";
                    var item = data["data"];
                    for (var i = 0; i < item.length; i++) {
                        bufferImage = "";
                        var imagelist = item[i]["ImagePath"];
                        for (var j = 0; j < imagelist.length; j++) {
                            bufferImage = bufferImage + "<img width='100px' height='100px' src='" + imagelist[j] + "'>";
                        }
                        buffer = buffer + "<li class='myfeel-item'><div class='feel-item-info clearfix' ><a class='info-img' href='#'><img width='10%' height='10%' src='" + item[i].Icon + "'></a > <div class='info-name'><a href = '#' >" + item[i].ShowName + "</a><p><span class='feeltime'>" + TimeFormat(item[i].CreateTime) + "</span></p></div><a class='btnFavor' favors='" + item[i].TalkID + "'><i class='layui-icon'>&#xe6c6;<span>" + item[i].TalkFavorsNum + "</span></i></a></div><div class='fell-item-content'><p>" + item[i].TalkContent + "</p></div><div>" + bufferImage+ "</div></li>";
                    }
                    buffer = buffer + "<li><input type='button' id='btnevent' pageIndex='";
                    buffer = buffer + pageIndex + "' value='查看更多'/></li>";
                    $("#btnevent").remove();
                    $("#list").append(buffer);
                    BindEnrollClickEvent();
                    BindActivtyListClickEvent();
                } else {
                    $("#btnevent").remove();
                    var buffer = "<p> 无更多心得</p>"
                    $("#list").append(buffer);
                }
            });

        }

        //查看更多活动按钮绑定
        function BindActivtyListClickEvent() {
            $("#btnevent").click(function () {
                var pageIndex = parseInt($("#btnevent").attr("pageIndex"));
                var pageSize = 5;
                GetActivityData(pageIndex, pageSize);
            });
        }

        //点赞按钮绑定事件
        function BindEnrollClickEvent() {
            $(".btnFavor").click(function () {
                var s = $(this);
                var talkId = $(this).attr("favors");
                $.post("/Favors/Create/", { talkId: talkId }, function (data) {
                    if (data["msg"] == "success") {
                        s.children("i").children("span").empty().html(data["num"]);
                    }

                });
            });
        }

        //时间戳转为时间
        function TimeFormat(value) {
            return new Date(parseInt(value.replace("/Date(", "").replace(")/", ""), 10)).pattern("yyyy-MM-dd HH:mm");
        }

    </script>
</head>
<body>
    <header>
        <nav class="top">
            <p>我的心得</p>
        </nav>
    </header>

    <div class="myfeel">
        <ul class="myfeel-list" id="list">
            
        </ul>
    </div>
    <!-- 侧边栏组件 -->
    <div class="topback" id="topback">
        <img src="images/topback.png">
    </div>
    <a href="javascript:history.go(-1)" class="header-back">
        <span class="glyphicon glyphicon-chevron-left"></span>
    </a>
   
</body>
</html>